---
title: "Sesi√≥n 1: Introducci√≥n a R y Estad√≠stica Descriptiva (I)"
subtitle: "Taller de M√©todos y T√©cnicas de Investigaci√≥n I [BORRADOR]"
date: "2025-10-21"
format:
  html:
    code-fold: false
    code-tools: true
    toc: true
    toc-depth: 3
---

## Objetivos de la sesi√≥n

Al finalizar esta sesi√≥n ser√°s capaz de:

- Navegar en la interfaz de RStudio
- Obtener conocimientos b√°sicos sobre R y su l√≥gica de programaci√≥n
- Crear y manipular objetos b√°sicos en R (vectores, dataframes)
- Importar datos, cargar paquetes, crear funciones de usuario
- Calcular medidas de tendencia central
- Crear tablas de frecuencia simples y de contingencia

---

## 1. Introducci√≥n a R y RStudio

### ¬øQu√© es R?

R es un lenguaje de programaci√≥n especializado en an√°lisis estad√≠stico y visualizaci√≥n de datos. Es:

- **Gratuito y de c√≥digo abierto**
- Se ha consolidado en las √∫ltimas d√©cadas como una herramienta de primer nivel para el an√°lisis estad√≠stico y programaci√≥n ([Fern√°ndez-Avil√©s y Montero, 2024](https://cdr-book.github.io/index.html))
- **Potente** para an√°lisis estad√≠sticos complejos
- **Vers√°til** con miles de paquetes disponibles
- **Reproducible**: tu an√°lisis queda documentado en c√≥digo :)

### La interfaz de RStudio

RStudio tiene 4 paneles principales:

1. **Editor** (arriba izquierda): Donde escribes tu c√≥digo en scripts
2. **Consola** (abajo izquierda): Donde se ejecuta el c√≥digo y ves resultados
3. **Environment** (arriba derecha): Muestra tus objetos/datos cargados
4. **Files/Plots/Help** (abajo derecha): Archivos, gr√°ficos, ayuda

Estos paneles se pueden modificar a comodidad, as√≠ como el theme del IDE, el tama√±o y fuente de la letra y c√≥digo, etc. Lo importante no es s√≥lo que aprendas a usar las herramientas que nos entrega RStudio, sino que tambi√©n lo hagas una herramienta propia para usar R de la manera m√°s c√≥moda posible. Al final, como R es un *lenguaje* de programaci√≥n, cada quien puede hablarlo como quiera, con sus ma√±as y pr√°cticas. 

::: {.callout-tip}
## Consejo
Siempre trabaja con **scripts** (archivos .R o .qmd) en lugar de escribir directo en la consola. As√≠ tu trabajo queda guardado y es reproducible.
:::

Antes de comenzar, cabe aclarar que iremos tratando de exponer el contenido de R no tanto en orden como si fuera solo un curso de R, sino que siguiendo la l√≥gica de un curso de metodolog√≠a. Para ello, tem√°ticamente, iremos avanzando en funci√≥n de los contenidos del programa y, *en virtud de ello*, veremos *c√≥mo hacer* esto en R. Ahora bien, no por ello no nos detendremos todo lo que necesiten en alg√∫n aspecto de R que quieran profundizar. Recuerden que este curso es para aportarles herramienrtas **metodol√≥gicas** para sus investigaciones de Mag√≠ster, para las que probablemente tengan que hacer un uso extensivo de R (incluso para investigaciones m√°s cualitativas). 

---

## 2. Conceptos b√°sicos de R

R, ante todo, es "un sistema para **computaci√≥n estad√≠stica**: software de **an√°lisis de datos** y **lenguaje de programaci√≥n**" ([Cano en Fern√°ndez-Avil√©s y Montero, 2024](https://cdr-book.github.io/ch-110003.html)). Es ampliamente utilizado en investigaci√≥n y docencia, pero tambi√©n ha tomado un lugar importante en la industria y el servicio p√∫blico. 

R naci√≥ como una adaptaci√≥n (en clave software libre y bajo la l√≥gica de programaci√≥n reproducible) del lenguaje S, complement√°ndolo con un excelente soporte para el uso estad√≠stico ([Wickham y Grolemund, 2023](https://es.r4ds.hadley.nz/01-intro.html)). R tiene una l√≥gica de programaci√≥n llamada Programaci√≥n Orientada a Objetos (OOP, por sus cifras en ingl√©s: *object-oriented programming*), el cual permite un polimorfismo muy √∫til y versatil para programaci√≥n estad√≠stica y que se relaciona con la *encapsulaci√≥n* de objetos ([Wickham, 2019](https://adv-r.hadley.nz/introduction.html)). M√°s all√° de tecnicismos, veremos todo esto en el curso, con ejemplos aplicados a sus investigaciones del Mag√≠ster.   

### Preparaci√≥n

```{r}
#| label: setup
#| message: false
#| warning: false

# Cargar librer√≠as necesarias
library(tidyverse)  # Para manipulaci√≥n de datos
library(psych)      # Para estad√≠stica descriptiva
library(sjmisc)     # Para explorar datos
library(haven)      # Para cargar archivos .dta o .sav
library(kableExtra) # Para presentacion de resultados

# Configuraci√≥n
options(scipen = 999)  # Evitar notaci√≥n cient√≠fica
```

### Operaciones b√°sicas

R funciona como una calculadora avanzada:

```{r}
#| label: operaciones-basicas

# Operaciones aritm√©ticas
5 + 3
10 - 2
4 * 6
20 / 4
2^3  # Potencia

# R respeta el orden de operaciones
(5 + 3) * 2
```

### Crear objetos

En R guardamos informaci√≥n en **objetos** usando `<-`:

```{r}
#| label: crear-objetos

# Crear un objeto num√©rico
edad <- 25
edad

# Crear un vector (secuencia de valores)
edades <- c(23, 25, 28, 30, 22, 27)
edades

# Operaciones con vectores
mean(edades)    # Promedio
length(edades)  # Largo del vector
```

::: {.callout-note}
## Nota importante
Los nombres de objetos:
- Pueden contener letras, n√∫meros, `.` y `_`
- NO pueden empezar con n√∫meros
- R distingue entre may√∫sculas y min√∫sculas (`edad ‚â† Edad`), lo que se suele conocer como un lenguaje *key-sensitive*
:::

#### Crear objetos: vectores y matrices

Guardar objetos tambi√©n nos permite hacer operaciones matem√°ticas m√°s complejas, por ejemplo para el uso de una calculadora de algebra lineal. Tambi√©n se pueden hacer simulaciones, con una distribuci√≥n deseada, para hacer m√°s interesante nuestras operaciones. Veamos primero la creaci√≥n de objetos y luego operaciones m√°s complejas

```{r algebra-lineal-objetos, collapse=TRUE}
#| label: algebra-lineal-objetos

# a) Creaci√≥n de un vector de n√∫meros naturales del 1 al 8
vector1 <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 25, 44, 36, 20, 50, 88)
vector1

# b) Creaci√≥n de un vector con n√∫meros reales comprendidos entre 1 y 6
set.seed(123)
vector2 <- runif(60, 1, 6)
vector2

# c) Creaci√≥n de un vector con n√∫meros que provienen de una distribuci√≥n normal
vector3 <- rnorm(30, 0, 2)
vector3

# d) Creaci√≥n de un vector con caracteres (letras)
vector4 <- c("Lima", "Ucayali", "Loreto", "San Juan", "Pucallpa")
vector4

# e) Creaci√≥n de un vector que combine n√∫meros y texto
vector5 <- c("rojo", 3, "Azul", 7, "morado", 10)
vector5

#OTRO CASOS CON VECTORES
#a) Crea un vector con los primeros 20 n√∫meros pares.
vector1 <- seq(2, 40, by = 2)
vector1

#b) Simular 50 valores entre 5 y 15, pero solo n√∫meros enteros (valores repetidos).
vector2 <- sample(5:15, 50, replace = TRUE)
vector2

# Simular 50 valores entre 5 y 150, pero solo n√∫meros enteros (valores no repetidos).
vector2 <- sample(5:150, 50, replace = FALSE)
vector2
# Crear un vector con categor√≠as de satisfacci√≥n (Baja, Media, Alta) y convi√©rtelo en 
#factor ordenado.
vector3 <- factor(sample(c("Baja", "Media", "Alta"), 30, replace = TRUE), 
                  levels = c("Baja", "Media", "Alta"), 
                  ordered = TRUE)
vector3

# Generar un vector con los primeros 15 valores de una progresi√≥n geom√©trica de raz√≥n 3.
vector4 <- 2*(3/11)^(0:14)
vector4

# Generar 100 valores de un proceso AR(1):
#Xt=0.7Xt-1+et donde et~N(0,1)
set.seed(123)
vector5 <- numeric(100)
vector5[1] <- rnorm(1)
for (t in 2:100) {
  vector5[t] <- 0.7 * vector5[t-1] + rnorm(1)
}
vector5

#--Graficar la serie de tiempo
plot.ts(vector5, col="#7F000D", main="Proceso AR(1)")

```

¬øY si quisieramos operaciones con vectores? Hagamos un ejercicio. Sean los vectores $A$ y $B$, ambos con la misma cantidad de n√∫meros aleatorios. El vector $A$ contiene datos que provienen de una distribuci√≥n chi-cuadrada con 3 grados de libertad (gl), mientras que el vector $B$ contiene datos que provienen de una distribuci√≥n uniforme definida en el intervalo $[3, 5]$. Entonces, hallemos con R la soluci√≥n a los siguientes c√°lculos: 

1. $2A+5B$

2. $\sin(A)+\cos(B)‚àí\tan(A+B)$

3. $\sqrt[3]{A} + \exp(B) - 4B^2$

4. $\log(A+1)+B^3-10 \sqrt{B}$

```{r algebra-lineal-operaciones, collapse=TRUE}
#| label: algebra-lineal-objetos-operaciones

# Definimos objetos para la creaci√≥n de los objetos seg√∫n instrucciones
n=80
A<-rchisq(n,3) # Distribuci√≥n Chi-Cuadrada con 3 gl
B<-runif(n,3,5) # Distribuci√≥n uniforme [3,5]

# Hallar los siguientes c√°lculos:
#1) 2A+5B
R1 <- 2*A + 5*B
R1

#2) sin(A)+cos(B)‚àítan(A+B)
R2 <- sin(A) + cos(B) - tan(A + B)
R2

#3) raiz_c√∫bica(A) + exp(B) - 4B^2
R3 <- A^(1/3) + exp(B) - 4*B^2
R3

#4) log(A+1)+B^3-10raiz(B)
R4 <- log(A + 1) + B^3 - 10*sqrt(B)
R4

```

¬°¬°¬ø¬ø¬øY matrices??!! Podemos hacerlo de distintas maneras: 

```{r algebra-matricial, collapse=TRUE}
#| label: algebra-matricial

# 1Ô∏è‚É£ Declaraci√≥n de Matrices en R (Forma Manual))
A <- matrix(c(6,5,4,1.2,6,4,7,7,8,2.5,1.15,6,4,5,7,3), nrow=4, byrow=TRUE)
A

B <- matrix(c(5, sqrt(7), exp(2), 7, -1/7, 6), nrow=2, byrow=TRUE)
B



#2Ô∏è‚É£ Declaraci√≥n de Matrices Aleatoriass
A <- matrix(rnorm(36), nrow=6)  # 6√ó6 con distribuci√≥n normal est√°ndar
A

B <- matrix(runif(25, 7, 20), nrow=5)  # 5√ó5 con distribuci√≥n uniforme en [7,20]
B

C <- diag(rnorm(16,6,1.75), nrow=4)  # 4√ó4 con valores en la diagonal
C


D <- diag(1, nrow=5)  # Matriz identidad de orden 5
D

E <- diag(0, nrow=5)  # Matriz nula de orden 5
E

G <- diag(rnorm(5))  # Matriz diagonal
G[upper.tri(G)] <- rnorm(5)  # Convertir en matriz triangular superior
G

G <- diag(rnorm(5))
G[lower.tri(G)] <- rnorm(5)  # Convertir en matriz triangular inferior
G

```


Con ello, podemos hacer las siguiente operaciones: 

```{r algebra-matricial-operaciones, collapse=TRUE}
#| label: algebra-matricial-operaciones

#3Ô∏è‚É£ Transpuesta de una Matriz
A <- matrix(rnorm(36,3,0.2), nrow=9)
A
t(A)  # Transpuesta

#4Ô∏è‚É£ Traza de una Matriz
A <- matrix(rnorm(25), nrow=5)
A
traza <- sum(diag(A))
paste("La traza es:", traza)


#5Ô∏è‚É£ Suma de Matrices
A <- matrix(rnorm(30), nrow=6)
B <- matrix(rnorm(30,5,2), nrow=6)
A + B  # Suma de matrices

#6Ô∏è‚É£ Producto de un Escalar por una Matriz
C <- matrix(rnorm(40,6,1), nrow=8)
sqrt(7) * C  # Producto con un escalar

A <- matrix(runif(42), nrow=7)
B <- matrix(runif(42,4,6), nrow=7)
P <- 2.35 * A + log(13) * B  # Combinaci√≥n lineal de matrices
P

#7Ô∏è‚É£ Multiplicaci√≥n de Matrices
A <- matrix(runif(30,1,3), nrow=5)  # 5√ó6
B <- matrix(runif(30,2,9), nrow=6)  # 6√ó5
A %*% B  # Producto de matrices
(1/2*A) %*% (exp(3)*B)
(1/17*B) %*% (4*A)

#8Ô∏è‚É£ Determinante de una Matriz
A <- matrix(runif(36,1,10), nrow=6)
A
det(A)  # Determinante de la matriz

#9Ô∏è‚É£ Rango de una Matriz
A <- matrix(runif(25,10,36), nrow=5)
A
qr(A)$rank  # Rango de la matriz


B <- matrix(runif(28,9,100), nrow=7)
B
qr(B)$rank


#üîü Inversa de una Matriz
A <- matrix(runif(36,0,10), nrow=6)
A
inv <- solve(A)  # Inversa de la matriz
inv
round(A %*% inv)  # Verificaci√≥n: debe aproximarse a la matriz identidad

```


Incluso podr√≠amos calcular MCO matricialmente^[La expresi√≥n $\hat{\beta} = (X^\top X)^{-1} X^\top y$ se puede demostrar, pero no es objeto de esta clase (ni curso)]. Solo tendr√≠amos que seguir la expresi√≥n que se obtiene al derivar los estimadores MCO con notaci√≥n matricial, es decir, 
$$
\hat{\beta} = (X^\top X)^{-1} X^\top y
$$
donde nuestra variable dependiente es un vector-columna de $n\times 1$ dimensiones; los par√°metros $\beta$ tambi√©n son un vector columna $k+1\times 1$ dimensiones; las variables independientes son una matriz de $n\times k+1$ dimensiones; y los residuos del modelo son de $n\times 1$ dimensiones. De manera tal que se tiene 
$$
Y_{n\times 1} = \begin{bmatrix}
Y_1 \\
Y_2 \\
\vdots \\
Y_n
\end{bmatrix}, \quad 
X_{n\times (k+1)} =
\begin{bmatrix}
1 & X_{11} & a_{12} & \cdots & a_{1k} \\
1 & X_{21} & a_{22} & \cdots & a_{2k} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & X_{n1} & a_{n2} & \cdots & a_{nk}
\end{bmatrix},
\quad
\beta_{k+1\times 1} =
\begin{bmatrix}
\beta_0 \\
\beta_1 \\
\vdots \\
\beta_k
\end{bmatrix}, 
\quad
U_{n\times 1} =
\begin{bmatrix}
U_1 \\
U_2 \\
\vdots \\
U_n
\end{bmatrix}
$$

Simulemos, entonces, un caso conocido: la ecuaci√≥n de Mincer. Un ejemplo relativamente b√°sico de esta ser√≠a el siguiente: 
$$
\ln \text{salario}_i = \ln \beta_0 + \beta_1 \text{educ}_i +\beta_2 \text{exp}_i+\beta_3 \text{exp}_i^2+ \beta_4 \text{dummy-mujer}_i + u_i
$$
donde la variable dependiente es salario del individuo $i$, a la cual se le aplica un logaritmo natural; $\beta_0$ es el intercepto (salario de alguien sin educaci√≥n ni experiencia (ni mujer)); $\text{educ}_i$ es la variable que registra los a√±os de escolaridad del individuo $i$; $\text{exp}_i$ es la variable que contiene la experiencia laboral del individuo $i$; $\text{dummy-mujer}_i$ es una variable que identifica si $i$ es mujer o no; y $u_i$ es el t√©rmino de error. Veamos c√≥mo podr√≠amos hacer esto en R con una simulaci√≥n: 


```{r MCO-matrices, collapse=TRUE}
#| label: MCO-matricial

# MCO "a mano" (solo betas) + comparaci√≥n con lm()
set.seed(2025)

# 1) Simulaci√≥n tipo Mincer
n <- 1000
esc   <- pmax(0, round(rnorm(n, 12, 2)))
exp   <- pmax(0, round(rnorm(n, 15, 5)))
mujer <- rbinom(n, 1, 0.45)

b0 <- 1.5; b_esc <- 0.08; b_exp <- 0.10; b_exp2 <- -0.002; b_muj <- -0.20
eps <- rnorm(n, 0, 0.30)
y <- b0 + b_esc*esc + b_exp*exp + b_exp2*(exp^2) + b_muj*mujer + eps  # log ingreso

# 2) Matriz de dise√±o y vector
X <- cbind(1, esc, exp, exp^2, mujer) # Matriz X
colnames(X) <- c("(Intercept)", "esc", "exp", "exp2", "mujer")

# 3) Betas por √°lgebra matricial:  Œ≤ÃÇ = (X'X)^(-1) X'y
beta_hat <- solve(t(X) %*% X) %*% (t(X) %*% y) 

# 4) Comparaci√≥n con lm()
beta_lm <- coef(lm(y ~ esc + exp + I(exp^2) + mujer))

# 5) Mostrar lado a lado
out <- cbind(beta_manual = as.numeric(beta_hat), beta_lm = as.numeric(beta_lm))
rownames(out) <- colnames(X)
round(out, 6)


```


### Tipos de datos

No obstante, para todo ello, ¬°hay que aprender R! Probablemente muchxs de ustedes ya saben algo de R. A su vez, si saben R pero no como derivar MCO no se preocupen, no es necesario saber esto para hacer una regresi√≥n en R. Es m√°s, como vieron, `lm()` que es la funci√≥n m√°s b√°sica para realizar regresiones lineales en R realiza la operaci√≥n matricial que hicimos en una sola l√≠nea de c√≥digo (`lm(y ~ esc + exp + I(exp^2) + mujer)`). Todo lo anterior, por tanto, fueron ejemplos de cosas que se pueden hacer en R, utiliz√°ndolo m√°s "en bruto" y para que puedan visualizar su potencial. 

Pero volvamos a R. Los objetos de R tienen distintas "clases". Para efectos del curso, podemos pensar esto como la naturaleza de variables, i.e., como variables cuantitativas (discretas y continuas) y cualitativas (ordinales y nominales). Los objetos de R tienen categor√≠as similares. Pero tambi√©n tienen combinaciones, como los objetos `dbl+lbl`, que son num√©ricos y con etiquetas. Adicionalmente, tambi√©n podemos encontrar datos de tipo l√≥gico (`TRUE` y `FALSE`). 

```{r, collapse=TRUE}
#| label: tipos-datos

# Num√©rico
numero <- 42
class(numero)

# Car√°cter (texto)
nombre <- "Mar√≠a"
class(nombre)

# L√≥gico
es_estudiante <- TRUE
class(es_estudiante)

# Factor (categor√≠as)
nivel_educacion <- factor(c("B√°sica", "Media", "Superior", "Media"))
nivel_educacion
```

---

## 3. Trabajar con DataFrames

Los **dataframes** son tablas de datos, similares a hojas de Excel. Cada columna es una variable, cada fila es una observaci√≥n. Es en este formato en el que trabajaremos con bases de datos reales. 

### Crear un dataframe

```{r}
#| label: crear-dataframe

# Crear un dataframe desde vectores
estudiantes <- data.frame(
  nombre = c("Ana", "Bruno", "Carla", "Diego", "Elena"),
  edad = c(23, 25, 24, 26, 23),
  carrera = c("Sociolog√≠a", "Sociolog√≠a", "Antropolog√≠a", 
              "Sociolog√≠a", "Antropolog√≠a"),
  nota = c(6.5, 5.8, 6.9, 6.2, 7.0)
)

# Ver el dataframe
estudiantes
```

Pero partamos inmediatamente con bases de datos reales. Tomemos la Encuesta Nacional de Empleo, realizada por el INE mes a mes y que agrupa datos trimestrales. Para ello, utilizaremos la funci√≥n `read.csv()`, del paquete `utils`, pues las bases de datos vienen en formato `.csv`. Una vez que cargamos los datos, exploraremos nuestra base de datos. No obstante, conviene saber antes que los archivos `.csv` son archivos de texto, que generalmente hay que especificar el delimitador que usa para separar las columnas (`;` o `,` com√∫nmente). 

```{r}
#| label: cargar-ene

datos <- read.csv("data-sesiones/ene-2025-07-jja.csv", # Ruta
                  sep=",", # Delimitador
                  encoding = "UTF-8" # UTF-8 o Latin-1
                  )

head(datos) # UPS

datos <- read.csv("data-sesiones/ene-2025-07-jja.csv", # Ruta
                  sep=";", # Delimitador
                  encoding = "Latin-1", # UTF-8 o Latin-1
                  stringsAsFactors = F # character to factor
                  ) 

head(datos) # :D
```




### Explorar datos

```{r , collapse=TRUE}
#| label: explorar-datos

# Estructura del dataframe
str(datos)

# Estructura con glimpse
glimpse(datos)

# Dimensiones (filas x columnas)
dim(datos)


```

### Explorar variables

En el formato `data.frame`, las columnas son las variables y las filas son las observaciones, i.e., la informaci√≥n de cada persona encuestada para cada variable (columna). En este sentido, a trav√©s de la fila vemos lo que respondi√≥ cada informante en las preguntas que se les realiz√≥ en la determinada encuesta (o en las variables derivadas del cuestionario). Por ello, conviene revisar los manuales metodol√≥gicos, los libros de c√≥digos, los cuestionarios, etc., de la encuesta que estemos usando. Para nuestro caso, revisando el [Libro de C√≥digos de la ENE](https://www.ine.gob.cl/docs/default-source/ocupacion-y-desocupacion/metadatos/2020/encuesta-nacional-de-empleo---a√±o-de-referencia-2020.pdf?sfvrsn=bc1fb0e6_8), podr√≠amos revisar las siguientes variables:

```{r , collapse=TRUE}
#| label: acceder-variables

# Acceder a una columna espec√≠fica con $
estudiantes$edad

# Otra forma: usando corchetes
estudiantes[, "edad"]


# Ahora con funciones de R y variables de la ENE 
# Condici√≥n de actividad (Ocupados (1), Desocupado (2) y Fuerza de la FDT (3))
frq(datos$activ) # Proporci√≥n de activ

# Clasificaci√≥n Internacional de Nivel Educacional (CINE) 1997
frq(datos$cine97) # Proporci√≥n CINE 97

# Condici√≥n de actividad econ√≥mica general
## Ver categorias en documento
frq(datos$cae_general)
```

::: {.callout-tip}
## Tip: Rutas relativas
Usa rutas relativas desde tu archivo .R:
- `../data/archivo.csv` (sube una carpeta, entra a data)
- Nunca uses `C:/Mi Computador/...` (no funcionar√° en otros computadores)
:::

Obviamente, como son muy astutxs, ya se estar√°n preguntando si se pueden hacer an√°lisis m√°s refinados. Ciertamente s√≠, y eso iremos viendo a lo largo del curso y tambi√©n en esta sesi√≥n. Pero por poner un ejemplo, la ENE se utiliza para para calcular indicadores como la tasa de ocupaci√≥n, desempleo, de participaci√≥n, de ocupaci√≥n informal, etc. Aunque a√∫n no veremos c√≥mo hacerlo estimando nuestra muestra a nivel poblacional (con muestras complejas (`survey` y `srvyr`)).

La ENE calcula la tasa de ocupaci√≥n como 
$$
\text{Tasa de ocupacion} = \frac{\text{Ocupados/as}}{\text{Poblacion en edad de trabajar}} \times 100
$$
Como ya les parecer√° obvio por su astucia, vimos una variable que nos permitir√≠a c√≥mo calcular esto: `activ`. Dado que `1. Ocupados/as`, entonces, solo habr√≠a que

```{r , collapse=TRUE}
#| label: tasa-ocupacion

## Tasa de ocupaci√≥n muestral (sin survey)
## Requiere en 'datos' las variables: activ (1=ocupado, 2/3=no (o sea PET)) y edad

# 1) Variables auxiliares equivalentes a Stata
datos$oc    <- ifelse(datos$activ == 1, 1, 0)        # ocupado
datos$may15 <- ifelse(datos$edad  >= 15, 1, 0)       # PET potencial (15+)

# 2) Tasa de ocupaci√≥n (toc)
datos$toc <- ifelse(datos$may15 == 1, datos$oc, NA_real_)

# 3) Estimaci√≥n muestral de la tasa de ocupaci√≥n (subpoblaci√≥n edad>=15)
numerador   <- sum(datos$oc  [datos$may15 == 1 & !is.na(datos$activ)], na.rm = TRUE)
denominador <- sum(          datos$may15 == 1 & !is.na(datos$activ))
toc_muestra <- numerador / denominador

toc_muestra                    # proporci√≥n
toc_muestra * 100              # porcentaje


```

Esto significar√≠a que, a nivel muestral, la tasa de ocupaci√≥n es del 51,36%. Pero, antes de pasar un procesamiento m√°s refinado de los datos, para justamente obtener indicadores y an√°lisis estad√≠sticos mejores, hay que mencionar que el c√≥digo anterior podr√≠a estar mucho m√°s optimizado. ¬øC√≥mo? Con nuestro nuevo amigo que nos acompa√±ar√° todo el curso: `dplyr`, paquete dentro de `tidyverse`. Con √©l, y sus funciones, podremos calcular la tasa de ocupaci√≥n (muestral) con una l√≠nea de c√≥digo concateando procesos con `|>` (o `%>%` que viene en `magritrr`, tambi√©n paquete incluido en `tidyverse`): 

```{r, collapse=TRUE}
#| label: tasa-ocup-dplyr

toc_muestra <- datos |>
  mutate(oc = activ == 1, # Creamos ocupado (oc) y mayores de 15 (may15)
         may15 = edad >= 15) |>  
  filter(may15, !is.na(activ)) |>  # Filtramos mayores de 15 y sin NA en activ
  summarise(toc = mean(oc)) |> # Calculamos promedio de ocupados
  pull(toc)   # Extraemos el valor num√©rico

toc_muestra          # Proporci√≥n
toc_muestra * 100    # Porcentaje


```


Dicho esto, es momento de avanzar en nuestro an√°lisis exploratorio de datos usando una base que nos permita profundizar en estad√≠stica descriptiva. Para ello, trabajaremos con la **Encuesta Suplementaria de Ingresos (ESI)**, que es un m√≥dulo complementario de la ENE aplicado anualmente en el trimestre noviembre-enero.

---

## 4. Trabajando con la Encuesta Suplementaria de Ingresos (ESI)

### ¬øQu√© es la ESI?

La Encuesta Suplementaria de Ingresos (ESI) es un m√≥dulo de la ENE que se aplica una vez al a√±o y tiene como objetivo principal caracterizar los ingresos de las personas y los hogares en Chile. Esta encuesta nos permite, entre otras cosas:

- Analizar la distribuci√≥n de ingresos en la poblaci√≥n
- Estudiar brechas salariales por g√©nero, edad, nivel educacional
- Examinar la relaci√≥n entre educaci√≥n y ingresos
- Comprender la estructura de ingresos laborales

Para nuestros prop√≥sitos metodol√≥gicos, esta base es ideal porque contiene variables tanto cuantitativas (edad, ingresos) como cualitativas (sexo, nivel educacional, condici√≥n de actividad), lo que nos permitir√° aplicar las distintas herramientas de estad√≠stica descriptiva que aprenderemos.

### Cargando la base de datos

Cargaremos la ESI 2024 directamente desde el sitio web del INE. Usaremos el paquete `haven` para leer archivos en formato Stata (.dta):

```{r}
#| label: cargar-esi-completo
#| message: false
#| warning: false

# Cargar la ESI 2024 desde el INE
esi2024 <- haven::read_dta("https://www.ine.gob.cl/docs/default-source/encuesta-suplementaria-de-ingresos/bbdd/stata_esi/2024/esi_2024.dta?sfvrsn=627c0f59_4&download=true")

# Explorar la estructura
esi2024 |> 
  glimpse()
```

Como pueden observar, la base contiene 85.172 observaciones y 282 variables. Para este ejercicio, trabajaremos con un subconjunto de variables que nos permitir√°n realizar an√°lisis descriptivos b√°sicos.

### Selecci√≥n y preparaci√≥n de variables

Para facilitar nuestro trabajo, seleccionaremos y renombraremos algunas variables clave. Adicionalmente, filtraremos la base de datos para observaciones que cumplan con 1) estar ocupados y 2) tener ingreso totales del trabajo. Finalmente, re-escribiremos sobre la base de datos, algo que no es recomendable, pero dado que no volveremos a usar `esi2024` no habr√° problemas en este caso. 

```{r}
#| label: preparar-esi
#| message: false

# Seleccionar y preparar variables de inter√©s
esi2024 <- esi2024 |> 
  select(
    sexo,           # Sexo de la persona
    edad,           # Edad en a√±os cumplidos
    nivel,          # Nivel educacional m√°s alto alcanzado
    ing_t_t,        # Ingreso total del trabajo
    activ,          # Condici√≥n de actividad
    region          # Regi√≥n de residencia
  ) |> 
  # Filtrar solo personas ocupadas con ingresos v√°lidos
  filter(
    activ == 1,           # Solo ocupados
    !is.na(ing_t_t),      # Con dato de ingreso
    ing_t_t > 0           # Ingresos positivos
  ) |> 
  # Crear etiquetas descriptivas
  mutate(
    # Etiqueta para sexo
    sexo_etiq = case_when(
      sexo == 1 ~ "Hombre",
      sexo == 2 ~ "Mujer",
      TRUE ~ "Otro"
    ),
    # Recodificar nivel educacional en categor√≠as agregadas
    nivel_etiq = case_when(
      nivel == 0 ~ "Sin educaci√≥n",
      nivel %in% c(1, 2, 3) ~ "Secundaria incompleta",
      nivel %in% c(4, 5, 6) ~ "Secundaria completa",
      nivel %in% c(7, 8, 9) ~ "Superior",
      nivel %in% c(10, 11, 12) ~ "Postgrado",
      TRUE ~ "Otros"
    ),
    nivel_etiq = factor(nivel_etiq, levels = c(
      "Sin educaci√≥n", "Secundaria incompleta", "Secundaria completa",
      "Superior", "Postgrado", "Otros"
    ))
  )

# Verificar dimensiones de la base filtrada
dim(esi2024)


```

::: {.callout-note}
## Nota sobre el filtrado
Hemos filtrado la base para trabajar solo con personas **ocupadas** (`activ == 1`) que reportan ingresos del trabajo v√°lidos. Esto es importante porque:

1. Los ingresos del trabajo solo aplican a personas que trabajan
2. Los valores `NA` o cero en ingresos podr√≠an indicar no respuesta o situaciones especiales
3. Para an√°lisis de brechas salariales, necesitamos comparar personas que efectivamente est√°n en el mercado laboral
:::

---

## 5. Estad√≠stica Descriptiva: Medidas de Tendencia Central

La estad√≠stica descriptiva nos permite resumir y organizar grandes vol√∫menes de datos en medidas que facilitan su comprensi√≥n. Comenzaremos con las **medidas de tendencia central**, que nos indican d√≥nde se "centra" la distribuci√≥n de nuestros datos.

### 5.1 La Media (Promedio)

La media aritm√©tica es la medida de tendencia central m√°s utilizada. Se calcula sumando todos los valores y dividiendo por el n√∫mero de observaciones:

$$
\bar{x} = \frac{\sum_{i=1}^{n} x_i}{n}
$$

En R, la funci√≥n `mean()` nos permite calcularla f√°cilmente:

```{r}
#| label: media-ingresos

# Ingreso promedio mensual
ingreso_promedio <- mean(esi2024$ing_t_t, na.rm = TRUE)

# Mostrar con formato
paste("El ingreso promedio mensual es:", 
      scales::dollar(ingreso_promedio, big.mark = ".", 
                     decimal.mark = ",", prefix = "$"))
```

La media es √∫til porque **usa toda la informaci√≥n disponible** (cada observaci√≥n contribuye al c√°lculo). Sin embargo, tiene una limitaci√≥n importante: **es sensible a valores extremos** (outliers).

### 5.2 La Mediana

La mediana es el valor que divide la distribuci√≥n en dos mitades iguales: 50% de las observaciones est√°n por debajo y 50% por encima. Es m√°s **robusta** a valores extremos que la media.

```{r}
#| label: mediana-ingresos

# Ingreso mediano mensual
ingreso_mediano <- median(esi2024$ing_t_t, na.rm = TRUE)

paste("El ingreso mediano mensual es:", 
      scales::dollar(ingreso_mediano, big.mark = ".", 
                     decimal.mark = ",", prefix = "$"))
```

### 5.3 Comparaci√≥n: Media vs Mediana

Comparemos ambas medidas:

```{r}
#| label: comparacion-media-mediana

# Crear tabla comparativa
tibble(
  Medida = c("Media", "Mediana", "Diferencia", "% Diferencia"),
  Valor = c(
    scales::dollar(ingreso_promedio, big.mark = ".", decimal.mark = ",", prefix = "$"),
    scales::dollar(ingreso_mediano, big.mark = ".", decimal.mark = ",", prefix = "$"),
    scales::dollar(ingreso_promedio - ingreso_mediano, big.mark = ".", decimal.mark = ",", prefix = "$"),
    paste0(round(((ingreso_promedio - ingreso_mediano)/ingreso_mediano)*100, 1), "%")
  )
) |> 
  kable(caption = "Comparaci√≥n entre media y mediana de ingresos")
```

**Interpretaci√≥n:** La diferencia entre media y mediana nos indica que la distribuci√≥n de ingresos est√° **sesgada hacia la derecha** (positivamente). Esto significa que hay algunas personas con ingresos muy altos que "arrastran" la media hacia arriba, mientras que la mediana nos da una mejor idea del ingreso "t√≠pico" de una persona en Chile. En cualquier caso, conviene comparar ambas medidas, pues nos entrega informaci√≥n sobre la distribuci√≥n de nuestra variable. 

::: {.callout-important}
## ¬øCu√°ndo usar media o mediana?

- **Usa la media** cuando:
  - La distribuci√≥n es aproximadamente sim√©trica
  - No hay valores extremos (outliers)
  - Necesitas usar toda la informaci√≥n disponible (ej: calcular promedios)

- **Usa la mediana** cuando:
  - La distribuci√≥n tiene sesgo (asim√©trica)
  - Hay valores extremos que pueden distorsionar la media
  - Quieres saber el valor "t√≠pico" (ej: salario mediano)
:::

En la siguiente sesi√≥n veremos m√°s medidas t√≠tpicas de la estad√≠stica descriptiva. Pero, por ahora, quedemonos con estas dos y veamos qu√© podemos hacer con ellas en R.


### 5.4 Visualizando media y mediana

Un histograma nos ayuda a visualizar esta diferencia:

```{r}
#| label: fig-dist-ingresos
#| fig-cap: "Distribuci√≥n de ingresos del trabajo con media y mediana"
#| fig-width: 10
#| fig-height: 6
#| warning: false

# Crear histograma con l√≠neas de tendencia central
esi2024 |> 
  ggplot(aes(x = ing_t_t)) +
  geom_histogram(bins = 50, fill = "#2A5783", alpha = 0.7, color = "white") +
  geom_vline(aes(xintercept = ingreso_promedio, color = "Media"), 
             linewidth = 1.2, linetype = "dashed") +
  geom_vline(aes(xintercept = ingreso_mediano, color = "Mediana"), 
             linewidth = 1.2, linetype = "dashed") +
  scale_x_continuous(
    labels = scales::dollar_format(big.mark = ".", decimal.mark = ",", prefix = "$"),
    limits = c(0, 3000000)  # Limitar eje x para mejor visualizaci√≥n
  ) +
  scale_color_manual(
    name = "Medidas de\ntendencia central",
    values = c("Media" = "#9C0824", "Mediana" = "#09622A")
  ) +
  labs(
    title = "Distribuci√≥n de Ingresos del Trabajo en Chile (ESI 2024)",
    subtitle = "Solo personas ocupadas con ingresos reportados",
    x = "Ingreso mensual del trabajo",
    y = "Frecuencia (n√∫mero de personas)",
    caption = "Fuente: INE, Encuesta Suplementaria de Ingresos 2024"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "right"
  )
```

**Observaciones del gr√°fico:**
- La mayor√≠a de las personas se concentra en ingresos m√°s bajos
- La distribuci√≥n tiene una "cola" hacia la derecha (ingresos altos)
- La mediana (l√≠nea verde) est√° m√°s cerca del centro de la concentraci√≥n de personas
- La media (l√≠nea roja) est√° desplazada hacia la derecha por efecto de los ingresos altos

---

## 6. An√°lisis por grupos: Estad√≠stica descriptiva bivariada

Una de las aplicaciones m√°s √∫tiles de la estad√≠stica descriptiva es **comparar grupos**. Por ejemplo, ¬øexisten diferencias en los ingresos seg√∫n el sexo de las personas? ¬øO seg√∫n su nivel educacional?

### 6.1 Ingresos por sexo

Calculemos las medidas de tendencia central separadas por sexo:

```{r}
#| label: ingresos-por-sexo

# Estad√≠sticas por sexo
esi2024 |> 
  group_by(sexo_etiq) |> 
  summarise(
    n = n(),
    Media = mean(ing_t_t, na.rm = TRUE),
    Mediana = median(ing_t_t, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(
    Media = scales::dollar(Media, big.mark = ".", 
                           decimal.mark = ",", prefix = "$"),
    Mediana = scales::dollar(Mediana, big.mark = ".", decimal.mark = ",", prefix = "$")
  ) |> 
  kable(
    caption = "Ingresos del trabajo por sexo",
    col.names = c("Sexo", "N", "Ingreso Promedio", "Ingreso Mediano")
  )
```

::: {.callout-warning}
## Brecha salarial de g√©nero
Los datos muestran una diferencia significativa en los ingresos entre hombres y mujeres. Esta es la llamada **brecha salarial de g√©nero**, un fen√≥meno persistente en Chile y el mundo que tiene m√∫ltiples causas (segregaci√≥n ocupacional, discriminaci√≥n, interrupciones en trayectorias laborales, etc.).
:::

### 6.2 Visualizaci√≥n de la brecha

Podemos visualizar esta diferencia con un boxplot:

```{r}
#| label: fig-boxplot-sexo
#| fig-cap: "Distribuci√≥n de ingresos por sexo"
#| fig-width: 10
#| fig-height: 6
#| warning: false

esi2024 |> 
  ggplot(aes(x = sexo_etiq, y = ing_t_t, fill = sexo_etiq)) +
  geom_boxplot(alpha = 0.7, outlier.alpha = 0.3) +
  scale_y_continuous(
    labels = scales::dollar_format(big.mark = ".", decimal.mark = ",", prefix = "$"),
    limits = c(0, 2500000)
  ) +
  scale_fill_manual(values = c("Hombre" = "#4292c6", "Mujer" = "#ef3b2c")) +
  labs(
    title = "Distribuci√≥n de Ingresos del Trabajo por Sexo",
    subtitle = "Chile, 2024",
    x = NULL,
    y = "Ingreso mensual del trabajo",
    caption = "Fuente: INE, ESI 2024\nNota: Se excluyen outliers extremos para mejor visualizaci√≥n"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 14)
  )
```

**Lectura del boxplot:**
- La l√≠nea horizontal dentro de la caja es la **mediana**
- Los bordes de la caja representan el **25% y 75%** de los datos (rango intercuart√≠lico)
- Los "bigotes" se extienden hasta aproximadamente 1.5 veces el rango intercuart√≠lico
- Los puntos son **valores at√≠picos** (outliers)

---

## 7. Tablas de frecuencia con datos reales

Las tablas de frecuencia son fundamentales para resumir variables categ√≥ricas. Veamos algunos ejemplos con la ESI.

### 7.1 Distribuci√≥n por nivel educacional

```{r}
#| label: tabla-educacion

# Tabla de frecuencias
tabla_educ <- esi2024 |> 
  count(nivel_etiq, name = "Frecuencia") |> 
  mutate(
    Porcentaje = round((Frecuencia / sum(Frecuencia)) * 100, 1),
    `Porcentaje acumulado` = cumsum(Porcentaje)
  )

tabla_educ |> 
  kable(
    caption = "Distribuci√≥n de personas ocupadas por nivel educacional",
    col.names = c("Nivel Educacional", "Frecuencia", "Porcentaje", "% Acumulado")
  )
```

### 7.2 Visualizaci√≥n de la distribuci√≥n educacional

```{r}
#| label: fig-educacion
#| fig-cap: "Distribuci√≥n de nivel educacional"
#| fig-width: 10
#| fig-height: 7
#| warning: false

esi2024 |> 
  filter(!is.na(nivel_etiq)) |> 
  count(nivel_etiq) |> 
  mutate(
    porcentaje = (n / sum(n)) * 100,
    nivel_etiq = fct_reorder(nivel_etiq, n)
  ) |> 
  ggplot(aes(x = nivel_etiq, y = porcentaje)) +
  geom_col(fill = "#E9C6EF", alpha = 0.8) +
  geom_text(aes(label = paste0(round(porcentaje, 1), "%")), 
            hjust = -0.2, size = 3.5) +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +  # Deja espacio para etiquetas
  labs(
    title = "Distribuci√≥n de Personas Ocupadas por Nivel Educacional",
    subtitle = "Chile, 2024",
    x = NULL,
    y = "Porcentaje",
    caption = "Fuente: INE, ESI 2024"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.major.y = element_blank()
  )
```

### 7.3 Tabla de contingencia: Sexo x Nivel educacional

Las **tablas de contingencia** (o tablas cruzadas) nos permiten analizar la relaci√≥n entre dos variables categ√≥ricas:

```{r}
#| label: tabla-contingencia-sexo-educ

# Tabla de contingencia
tabla_sexo_educ <- esi2024 |> 
  filter(!is.na(nivel_etiq)) |> 
  count(sexo_etiq, nivel_etiq) |> 
  pivot_wider(names_from = sexo_etiq, values_from = n, values_fill = 0)

tabla_sexo_educ |> 
  kable(caption = "Distribuci√≥n de nivel educacional por sexo")
```

Podemos tambi√©n ver las proporciones por fila (qu√© % de cada nivel educacional es hombre/mujer):

```{r}
#| label: proporciones-sexo-educ

# Proporciones por fila
esi2024 |> 
  filter(!is.na(nivel_etiq)) |> 
  count(nivel_etiq, sexo_etiq) |> 
  group_by(nivel_etiq) |> 
  mutate(
    prop = n / sum(n) * 100
  ) |> 
  select(-n) |> 
  pivot_wider(names_from = sexo_etiq, values_from = prop, values_fill = 0) |> 
  mutate(across(where(is.numeric), ~round(.x, 1))) |> 
  kable(
    caption = "Distribuci√≥n porcentual por sexo dentro de cada nivel educacional",
    col.names = c("Nivel Educacional", "% Hombres", "% Mujeres")
  )
```

---

## 8. Ingresos por nivel educacional

Un an√°lisis cl√°sico en econom√≠a laboral es examinar c√≥mo los ingresos var√≠an seg√∫n el nivel educacional (el **retorno** a la educaci√≥n):

```{r}
#| label: ingresos-por-educacion

# Ingresos promedio por nivel educacional
esi2024 |> 
  filter(!is.na(nivel_etiq)) |> 
  group_by(nivel_etiq) |> 
  summarise(
    n = n(),
    Ingreso_Promedio = mean(ing_t_t, na.rm = TRUE),
    Ingreso_Mediano = median(ing_t_t, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(
    Ingreso_Promedio = scales::dollar(Ingreso_Promedio, big.mark = ".", decimal.mark = ",", prefix = "$"),
    Ingreso_Mediano = scales::dollar(Ingreso_Mediano, big.mark = ".", decimal.mark = ",", prefix = "$")
  ) |> 
  kable(
    caption = "Ingresos del trabajo por nivel educacional",
    col.names = c("Nivel Educacional", "N", "Ingreso Promedio", "Ingreso Mediano")
  )
```

### Visualizaci√≥n: Ingresos por educaci√≥n

```{r}
#| label: fig-ingresos-educacion
#| fig-cap: "Ingresos medianos por nivel educacional"
#| fig-width: 10
#| fig-height: 7
#| warning: false

esi2024 |> 
  filter(!is.na(nivel_etiq)) |> 
  group_by(nivel_etiq) |> 
  summarise(
    ingreso_mediano = median(ing_t_t, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(nivel_etiq = fct_reorder(nivel_etiq, ingreso_mediano)) |> 
  ggplot(aes(x = nivel_etiq, y = ingreso_mediano)) +
  geom_col(fill = "#69000C", alpha = 0.7) +
  geom_text(
    aes(label = scales::dollar(ingreso_mediano, big.mark = ".", prefix = "$", accuracy = 1)),
    hjust = -0.1, size = 3
  ) +
  coord_flip() +
  scale_y_continuous(
    labels = scales::dollar_format(big.mark = ".", prefix = "$"),
    limits = c(0, max(esi2024 |> 
                        filter(!is.na(nivel_etiq)) |> 
                        group_by(nivel_etiq) |> 
                        summarise(med = median(ing_t_t, na.rm = TRUE)) |> 
                        pull(med)) * 1.15),
    expand = c(0, 0)
  ) +
  labs(
    title = "Ingreso Mediano del Trabajo por Nivel Educacional",
    subtitle = "Chile, 2024",
    x = NULL,
    y = "Ingreso mediano mensual",
    caption = "Fuente: INE, ESI 2024"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.major.y = element_blank()
  )
```

::: {.callout-tip}
## Interpretaci√≥n
Observamos una clara **relaci√≥n positiva** entre nivel educacional e ingresos: a mayor educaci√≥n, mayores ingresos medianos. Este es uno de los hallazgos m√°s robustos en econom√≠a laboral y justifica (en parte) la inversi√≥n en educaci√≥n como una forma de movilidad social.

Sin embargo, noten que el "salto" m√°s grande est√° en los niveles m√°s altos de educaci√≥n (de media completa a superior y de superior a postgrado). ¬øPor qu√© se produce este salto? ¬øEs solo por un aumento lineal (exponencial en rigor) en el ingreso *en funci√≥n* de los a√±os estudiando, o bien hay algo que impacta en el salario y no se puede ver en el gr√°fico?
:::

---

## 9. Ejercicios pr√°cticos

Ahora es tu turno de practicar con el dataframe simulado `encuesta`. Estos ejercicios te ayudar√°n a consolidar los conceptos aprendidos.

Primero, creemos el dataframe de pr√°ctica:

```{r}
#| label: crear-encuesta-practica

# Simular datos de encuesta para ejercicios
set.seed(123)  # Para reproducibilidad

encuesta <- data.frame(
  id = 1:100,
  edad = sample(18:65, 100, replace = TRUE),
  sexo = sample(c("Mujer", "Hombre"), 100, 
                replace = TRUE, prob = c(0.52, 0.48)),
  educacion = sample(c("B√°sica", "Media", "T√©cnica", "Universitaria", "Postgrado"), 
                     100, replace = TRUE, 
                     prob = c(0.10, 0.30, 0.25, 0.30, 0.05)),
  satisfaccion = sample(1:7, 100, replace = TRUE),
  ingreso = round(rnorm(100, mean = 800000, sd = 300000), -3)
)

# Vista previa
head(encuesta, 10)
```

---

::: {.callout-tip}
## Ejercicio 1: Calcular estad√≠sticos b√°sicos

Usando los datos de `encuesta`:

a) Calcula la edad promedio y mediana
b) Calcula el ingreso promedio y mediano
c) ¬øCu√°l es la satisfacci√≥n promedio?
d) Interpreta: ¬øLa distribuci√≥n de ingresos est√° sesgada? ¬øC√≥mo lo sabes?

**Pista:** Usa las funciones `mean()` y `median()`. Compara los resultados.
:::

```{r}
#| label: ejercicio-1-template
#| eval: false
#| code-fold: true

# a) Edad
mean(encuesta$edad)
median(encuesta$edad)

# b) Ingreso


# c) Satisfacci√≥n


# d) Interpretaci√≥n
# Escribe tu respuesta aqu√≠

```

::: {.callout-tip collapse="true"}
## Soluci√≥n Ejercicio 1

```{r}
#| label: solucion-1

# a) Edad promedio y mediana
cat("Edad promedio:", round(mean(encuesta$edad), 1), "a√±os\n")
cat("Edad mediana:", median(encuesta$edad), "a√±os\n\n")

# b) Ingreso promedio y mediano
cat("Ingreso promedio:", scales::dollar(mean(encuesta$ingreso), prefix = "$", big.mark = "."), "\n")
cat("Ingreso mediano:", scales::dollar(median(encuesta$ingreso), prefix = "$", big.mark = "."), "\n\n")

# c) Satisfacci√≥n promedio
cat("Satisfacci√≥n promedio:", round(mean(encuesta$satisfaccion), 2), "(escala 1-7)\n\n")

# d) Interpretaci√≥n
cat("Interpretaci√≥n:\n")
cat("Media:", scales::dollar(mean(encuesta$ingreso), prefix = "$", big.mark = "."), "\n")
cat("Mediana:", scales::dollar(median(encuesta$ingreso), prefix = "$", big.mark = "."), "\n")
cat("\nLa media es", 
    ifelse(mean(encuesta$ingreso) > median(encuesta$ingreso), "mayor", "menor"),
    "que la mediana, lo que sugiere un sesgo",
    ifelse(mean(encuesta$ingreso) > median(encuesta$ingreso), "positivo (hacia la derecha)", "negativo (hacia la izquierda)"),
    "en la distribuci√≥n de ingresos.")
```
:::

---

::: {.callout-tip}
## Ejercicio 2: Tabla de frecuencias

Crea una tabla de frecuencias para la variable `educacion` que incluya:
- Frecuencia absoluta
- Frecuencia relativa (porcentaje)
- Porcentaje acumulado

**Pista:** Usa `table()`, `prop.table()` y `cumsum()`
:::

```{r}
#| label: ejercicio-2-template
#| eval: false
#| code-fold: true

# Tu c√≥digo aqu√≠
# 1. Crear tabla de frecuencias absolutas


# 2. Calcular porcentajes


# 3. Agregar porcentaje acumulado


# 4. Presentar en formato tabla (usa kable)

```

::: {.callout-tip collapse="true"}
## Soluci√≥n Ejercicio 2

```{r}
#| label: solucion-2

# Crear tabla de frecuencias completa
tabla_educ <- as.data.frame(table(encuesta$educacion))
colnames(tabla_educ) <- c("Nivel_Educacional", "Frecuencia")

tabla_educ <- tabla_educ |> 
  mutate(
    Porcentaje = round((Frecuencia / sum(Frecuencia)) * 100, 1),
    Porcentaje_Acumulado = cumsum(Porcentaje)
  )

# Mostrar con kable
kable(
  tabla_educ,
  caption = "Distribuci√≥n de nivel educacional",
  col.names = c("Nivel Educacional", "Frecuencia", "Porcentaje (%)", "% Acumulado")
)
```
:::

---

::: {.callout-tip}
## Ejercicio 3: Tabla de contingencia

Crea una tabla de contingencia entre `sexo` y `educacion`.

a) ¬øCu√°ntos hombres tienen educaci√≥n universitaria?
b) ¬øCu√°ntas mujeres tienen educaci√≥n media?
c) Calcula las proporciones por fila (% dentro de cada sexo)
d) ¬øQu√© porcentaje de las mujeres tiene educaci√≥n universitaria?

**Pista:** Usa `table()` y `prop.table()` con `margin = 1` para proporciones por fila
:::

```{r}
#| label: ejercicio-3-template
#| eval: false
#| code-fold: true

# a) y b) Crear tabla de contingencia


# c) Proporciones por fila


# d) Interpretaci√≥n

```

::: {.callout-tip collapse="true"}
## Soluci√≥n Ejercicio 3

```{r}
#| label: solucion-3

# a) y b) Tabla de contingencia
tabla_sexo_educ <- table(encuesta$sexo, encuesta$educacion)
print("Tabla de contingencia: Sexo x Educaci√≥n")
tabla_sexo_educ

cat("\na) Hombres con educaci√≥n universitaria:", tabla_sexo_educ["Hombre", "Universitaria"], "\n")
cat("b) Mujeres con educaci√≥n media:", tabla_sexo_educ["Mujer", "Media"], "\n\n")

# c) Proporciones por fila (% dentro de cada sexo)
prop_fila <- prop.table(tabla_sexo_educ, margin = 1) * 100
print("Porcentajes por sexo:")
round(prop_fila, 1)

# d) Porcentaje de mujeres con educaci√≥n universitaria
cat("\nd) Porcentaje de mujeres con educaci√≥n universitaria:", 
    round(prop_fila["Mujer", "Universitaria"], 1), "%")
```
:::

## Ejercicio 4: An√°lisis de ingresos por grupo

Ahora realizaremos un an√°lisis m√°s complejo, comparando ingresos entre diferentes grupos.

::: {.callout-tip}
## Ejercicio 4: Ingresos por sexo y educaci√≥n

Usando el dataframe `encuesta`:

a) Calcula el ingreso promedio y mediano por sexo
b) Calcula el ingreso promedio por nivel educacional
c) Crea un gr√°fico de boxplot comparando ingresos entre hombres y mujeres
d) Interpreta: ¬øExiste una brecha salarial en estos datos simulados?

**Pista:** Usa `group_by()` y `summarise()` de `dplyr`, y `ggplot()` para el gr√°fico
:::

```{r}
#| label: ejercicio-4-template
#| eval: false
#| code-fold: true

# a) Ingresos por sexo
encuesta |> 
  group_by(sexo) |> 
  summarise(
    # completar aqu√≠
  )

# b) Ingresos por educaci√≥n


# c) Boxplot


# d) Interpretaci√≥n
# Escribe tu an√°lisis aqu√≠

```

::: {.callout-tip collapse="true"}
## Soluci√≥n Ejercicio 4

```{r}
#| label: solucion-4

# a) Ingresos por sexo
cat("=== Ingresos por sexo ===\n\n")
resumen_sexo <- encuesta |> 
  group_by(sexo) |> 
  summarise(
    n = n(),
    Ingreso_Promedio = mean(ingreso, na.rm = TRUE),
    Ingreso_Mediano = median(ingreso, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(
    Ingreso_Promedio = scales::dollar(Ingreso_Promedio, prefix = "$", big.mark = "."),
    Ingreso_Mediano = scales::dollar(Ingreso_Mediano, prefix = "$", big.mark = ".")
  )

kable(resumen_sexo, 
      caption = "Ingresos por sexo",
      col.names = c("Sexo", "N", "Ingreso Promedio", "Ingreso Mediano"))

# b) Ingresos por educaci√≥n
cat("\n=== Ingresos por nivel educacional ===\n\n")
resumen_educ <- encuesta |> 
  group_by(educacion) |> 
  summarise(
    n = n(),
    Ingreso_Promedio = mean(ingreso, na.rm = TRUE),
    Ingreso_Mediano = median(ingreso, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  arrange(desc(Ingreso_Mediano)) |> 
  mutate(
    Ingreso_Promedio = scales::dollar(Ingreso_Promedio, prefix = "$", big.mark = "."),
    Ingreso_Mediano = scales::dollar(Ingreso_Mediano, prefix = "$", big.mark = ".")
  )

kable(resumen_educ,
      caption = "Ingresos por nivel educacional",
      col.names = c("Educaci√≥n", "N", "Ingreso Promedio", "Ingreso Mediano"))
```

```{r}
#| label: solucion-4-grafico
#| fig-cap: "Comparaci√≥n de ingresos por sexo"
#| fig-width: 8
#| fig-height: 6

# c) Boxplot de ingresos por sexo
ggplot(encuesta, aes(x = sexo, y = ingreso, fill = sexo)) +
  geom_boxplot(alpha = 0.7) +
  scale_y_continuous(
    labels = scales::dollar_format(prefix = "$", big.mark = ".")
  ) +
  scale_fill_manual(values = c("Hombre" = "#4292c6", "Mujer" = "#ef3b2c")) +
  labs(
    title = "Distribuci√≥n de Ingresos por Sexo",
    subtitle = "Datos simulados de encuesta",
    x = NULL,
    y = "Ingreso mensual",
    caption = "Fuente: Datos simulados para ejercicio"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 13)
  )

# d) Interpretaci√≥n
cat("\n=== Interpretaci√≥n ===\n\n")
media_h <- mean(encuesta$ingreso[encuesta$sexo == "Hombre"])
media_m <- mean(encuesta$ingreso[encuesta$sexo == "Mujer"])
brecha <- ((media_h - media_m) / media_h) * 100

cat("En estos datos simulados:\n")
cat("- Ingreso promedio hombres:", scales::dollar(media_h, prefix = "$", big.mark = "."), "\n")
cat("- Ingreso promedio mujeres:", scales::dollar(media_m, prefix = "$", big.mark = "."), "\n")
cat("- Brecha salarial:", round(brecha, 1), "%\n\n")

if (brecha > 5) {
  cat("Existe una brecha salarial favorable a los hombres del", round(brecha, 1), "%.\n")
  cat("Esto significa que, en promedio, las mujeres ganan", 
      round(100 - (media_m/media_h * 100), 1), 
      "% menos que los hombres en esta muestra simulada.")
} else if (brecha < -5) {
  cat("Existe una brecha salarial favorable a las mujeres del", round(abs(brecha), 1), "%.")
} else {
  cat("No se observa una brecha salarial significativa (diferencia menor al 5%).")
}
```
:::

---

::: {.callout-tip}
## Ejercicio 5: Visualizaci√≥n avanzada

Crea un gr√°fico que muestre la distribuci√≥n de edad por nivel educacional.

Puedes elegir entre:
- Un histograma facetado por educaci√≥n
- Un boxplot con educaci√≥n en el eje X y edad en el eje Y
- Un gr√°fico de viol√≠n

**Bonus:** Agrega t√≠tulos, etiquetas y personaliza los colores.
:::

```{r}
#| label: ejercicio-5-template
#| eval: false
#| code-fold: true

# Tu c√≥digo aqu√≠
# Crea el gr√°fico que prefieras usando ggplot()

```

::: {.callout-tip collapse="true"}
## Soluci√≥n Ejercicio 5

```{r}
#| label: solucion-5-opcion1
#| fig-cap: "Distribuci√≥n de edad por nivel educacional (boxplot)"
#| fig-width: 10
#| fig-height: 6

# Opci√≥n 1: Boxplot
ggplot(encuesta, aes(x = educacion, y = edad, fill = educacion)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.3, size = 0.8) +  # Agregar puntos individuales
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Distribuci√≥n de Edad seg√∫n Nivel Educacional",
    subtitle = "Datos simulados de encuesta (N=100)",
    x = "Nivel Educacional",
    y = "Edad (a√±os)",
    caption = "Fuente: Datos simulados para ejercicio"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 13),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r}
#| label: solucion-5-opcion2
#| fig-cap: "Distribuci√≥n de edad por nivel educacional (viol√≠n)"
#| fig-width: 10
#| fig-height: 6

# Opci√≥n 2: Gr√°fico de viol√≠n
ggplot(encuesta, aes(x = educacion, y = edad, fill = educacion)) +
  geom_violin(alpha = 0.6, trim = FALSE) +
  geom_boxplot(width = 0.1, alpha = 0.8, outlier.alpha = 0) +
  scale_fill_viridis_d(option = "plasma") +
  labs(
    title = "Distribuci√≥n de Edad seg√∫n Nivel Educacional",
    subtitle = "Gr√°fico de viol√≠n con boxplot incorporado",
    x = "Nivel Educacional",
    y = "Edad (a√±os)",
    caption = "Fuente: Datos simulados para ejercicio\nEl ancho del viol√≠n representa la densidad de datos"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 13),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r}
#| label: solucion-5-opcion3
#| fig-cap: "Histogramas de edad por nivel educacional"
#| fig-width: 12
#| fig-height: 8

# Opci√≥n 3: Histogramas facetados
ggplot(encuesta, aes(x = edad, fill = educacion)) +
  geom_histogram(bins = 15, alpha = 0.8, color = "white") +
  facet_wrap(~educacion, ncol = 3) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    title = "Distribuci√≥n de Edad por Nivel Educacional",
    subtitle = "Histogramas separados para cada categor√≠a",
    x = "Edad (a√±os)",
    y = "Frecuencia",
    caption = "Fuente: Datos simulados para ejercicio"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 13),
    strip.text = element_text(face = "bold", size = 10)
  )
```
:::

---

## 10. Resumen de la sesi√≥n

En esta primera sesi√≥n hemos cubierto aspectos fundamentales tanto de R como de estad√≠stica descriptiva:

### ‚úÖ Conceptos de R aprendidos

- **Interfaz de RStudio**: Navegaci√≥n entre paneles (Editor, Consola, Environment, Files/Plots)
- **Operaciones b√°sicas**: R como calculadora avanzada
- **Creaci√≥n de objetos**: Vectores, matrices y dataframes
- **Operaciones vectoriales y matriciales**: Incluyendo √°lgebra lineal
- **Importaci√≥n de datos**: Archivos CSV y Stata (.dta)
- **Manipulaci√≥n de datos con `dplyr`**: 
  - `select()`: Seleccionar columnas
  - `filter()`: Filtrar filas
  - `mutate()`: Crear/modificar variables
  - `group_by()` y `summarise()`: Agrupar y resumir
  - Operador pipe `|>`: Encadenar operaciones
- **Exploraci√≥n de datos**: `glimpse()`, `head()`, `str()`, `dim()`
- **Visualizaci√≥n con `ggplot2`**: Histogramas, boxplots, gr√°ficos de barras

### ‚úÖ Conceptos estad√≠sticos aprendidos

- **Medidas de tendencia central**:
  - Media: Promedio aritm√©tico, sensible a valores extremos
  - Mediana: Valor central, robusta a outliers
  - Cu√°ndo usar cada una seg√∫n la distribuci√≥n de los datos
  
- **Distribuciones asim√©tricas**: Interpretaci√≥n de sesgo positivo/negativo comparando media y mediana

- **Tablas de frecuencia**:
  - Frecuencias absolutas y relativas
  - Frecuencias acumuladas
  - Tablas de contingencia (cruce de dos variables)
  - Proporciones por fila y columna

- **An√°lisis bivariado descriptivo**:
  - Comparaci√≥n de estad√≠sticos entre grupos
  - Identificaci√≥n de brechas (ej: brecha salarial de g√©nero)
  - Visualizaci√≥n de diferencias entre grupos

- **Interpretaci√≥n de gr√°ficos**:
  - Histogramas: Forma de la distribuci√≥n
  - Boxplots: Mediana, rango intercuart√≠lico, outliers
  - Gr√°ficos de barras: Frecuencias y proporciones

### üéØ Aplicaciones pr√°cticas

Trabajamos con dos bases de datos reales:
1. **ENE (Encuesta Nacional de Empleo)**: C√°lculo de tasas de ocupaci√≥n
2. **ESI (Encuesta Suplementaria de Ingresos)**: An√°lisis de ingresos, brechas salariales, y retornos a la educaci√≥n

Estos an√°lisis nos permitieron ver c√≥mo la estad√≠stica descriptiva es fundamental para:
- **Caracterizar** poblaciones y muestras
- **Identificar** patrones y tendencias
- **Comparar** grupos (g√©nero, educaci√≥n, edad)
- **Comunicar** hallazgos de manera efectiva

---

## 11. Recursos adicionales

### üìö Lecturas recomendadas

**Sobre R:**
- Wickham, H., & Grolemund, G. (2023). [*R para Ciencia de Datos*](https://es.r4ds.hadley.nz/). Cap√≠tulos 1-5 y 9-11.
- Fern√°ndez-Avil√©s, G., & Montero, J.M. (2024). [*Ciencia de Datos en R*](https://cdr-book.github.io/index.html). Cap√≠tulos 1-3.
- Wickham, H. (2019). [*Advanced R*](https://adv-r.hadley.nz/). Para profundizar en programaci√≥n orientada a objetos.

**Sobre Estad√≠stica Descriptiva:**
- Navarro, D. (2015). [*Learning Statistics with R*](https://learningstatisticswithr.com/). Cap√≠tulos 3-5.
- Verzani, J. (2014). *Using R for Introductory Statistics*. Cap√≠tulos 1-4.

**Documentaci√≥n oficial:**
- [Documentaci√≥n de `dplyr`](https://dplyr.tidyverse.org/)
- [Documentaci√≥n de `ggplot2`](https://ggplot2.tidyverse.org/)
- [RStudio Cheatsheets](https://posit.co/resources/cheatsheets/) (especialmente Data Transformation y Data Visualization)

### üé• Videos recomendados

- [Introducci√≥n a RStudio (10 min)](https://www.youtube.com/watch?v=lVKMsaWju8w)
- [R para principiantes - Tutorial completo](https://www.youtube.com/watch?v=_V8eKsto3Ug)
- [Visualizaci√≥n de datos con ggplot2](https://www.youtube.com/watch?v=h29g21z0a68)

### üíª Pr√°ctica interactiva

- [Swirl - Learn R, in R](https://swirlstats.com/) - Tutorial interactivo dentro de R
- [R for Data Science - Ejercicios](https://r4ds.hadley.nz/data-transform.html#exercises-9)
- [DataCamp - Introduction to R (gratis)](https://www.datacamp.com/courses/free-introduction-to-r)

### üîó Bases de datos para practicar

- [Encuesta Nacional de Empleo (ENE) - INE Chile](https://www.ine.gob.cl/estadisticas/sociales/mercado-laboral/ocupacion-y-desocupacion)
- [Encuesta Suplementaria de Ingresos (ESI) - INE Chile](https://www.ine.gob.cl/estadisticas/sociales/ingresos-y-gastos/encuesta-suplementaria-de-ingresos)
- [CASEN - Ministerio de Desarrollo Social](http://observatorio.ministeriodesarrollosocial.gob.cl/encuesta-casen)
- [Datasets incluidos en R](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html)

---

## 12. Preparaci√≥n para la pr√≥xima sesi√≥n

En la **Sesi√≥n 2** continuaremos con estad√≠stica descriptiva, enfoc√°ndonos en:

1. **Medidas de dispersi√≥n**:
   - Rango, varianza, desviaci√≥n est√°ndar
   - Rango intercuart√≠lico
   - Coeficiente de variaci√≥n

2. **Medidas de posici√≥n**:
   - Cuartiles, deciles, percentiles
   - Interpretaci√≥n y aplicaciones

3. **Introducci√≥n a pruebas de hip√≥tesis**:
   - Conceptos b√°sicos de inferencia estad√≠stica
   - Distribuci√≥n normal
   - Intervalos de confianza

### üìù Tarea para la pr√≥xima sesi√≥n

::: {.callout-important}
## Tarea obligatoria

Elige **una** de las siguientes bases de datos y realiza un an√°lisis descriptivo b√°sico:

**Opci√≥n 1: ENE (Encuesta Nacional de Empleo)**
- Descarga: [ENE m√°s reciente](https://www.ine.gob.cl/estadisticas/sociales/mercado-laboral/ocupacion-y-desocupacion)
- Analiza: Tasas de participaci√≥n laboral por regi√≥n y sexo

**Opci√≥n 2: ESI (Encuesta Suplementaria de Ingresos)**
- Ya usamos esta base en clase
- Analiza: Ingresos por regi√≥n y sector econ√≥mico

**Opci√≥n 3: Base de datos propia**
- Si tienes datos de tu investigaci√≥n de mag√≠ster, √∫salos
- Realiza an√°lisis descriptivo b√°sico

**Entregables (documento .Rmd o .qmd):**

1. Breve descripci√≥n de la base de datos (origen, a√±o, n¬∞ observaciones)
2. Selecci√≥n de 3-4 variables de inter√©s
3. An√°lisis descriptivo que incluya:
   - Tablas de frecuencia para variables categ√≥ricas
   - Medidas de tendencia central para variables num√©ricas
   - Al menos 2 visualizaciones (gr√°ficos)
4. Interpretaci√≥n de los resultados (2-3 p√°rrafos)

**Formato de entrega:**
- Archivo .Rmd o .qmd con c√≥digo y texto
- Renderizado a HTML o PDF
- Fecha l√≠mite: Antes de la Sesi√≥n 2
:::

### üí° Consejos para la tarea

- Revisa el c√≥digo de esta sesi√≥n como referencia
- Usa comentarios (`#`) para explicar tu c√≥digo
- Sigue las buenas pr√°cticas: nombres descriptivos de objetos, c√≥digo indentado
- Si tienes dudas, consulta la documentaci√≥n: `?nombre_funcion`
- Practica el flujo: importar ‚Üí explorar ‚Üí limpiar ‚Üí analizar ‚Üí visualizar

---

## 13. C√≥digo completo de la sesi√≥n

Si quieres replicar todo el an√°lisis de esta sesi√≥n, aqu√≠ est√° el c√≥digo completo:

```{r}
#| label: codigo-completo
#| eval: false
#| code-fold: true
#| code-summary: "Ver c√≥digo completo de la sesi√≥n"

# ============================================
# SESI√ìN 1: C√ìDIGO COMPLETO
# Taller de M√©todos y T√©cnicas de Investigaci√≥n I
# ============================================

# 1. PREPARACI√ìN ----
library(tidyverse)
library(psych)
library(sjmisc)
library(haven)
options(scipen = 999)

# 2. CARGAR ENE ----
datos <- read.csv("data-sesiones/ene-2025-07-jja.csv",
                  sep = ";",
                  encoding = "Latin-1",
                  stringsAsFactors = FALSE)

# Explorar
glimpse(datos)
frq(datos$activ)

# Calcular tasa de ocupaci√≥n (muestral)
toc_muestra <- datos |>
  mutate(
    oc = activ == 1,
    may15 = edad >= 15
  ) |>
  filter(may15, !is.na(activ)) |>
  summarise(toc = mean(oc)) |>
  pull(toc)

cat("Tasa de ocupaci√≥n muestral:", round(toc_muestra * 100, 2), "%\n")

# 3. CARGAR ESI ----
esi2024 <- haven::read_dta("https://www.ine.gob.cl/docs/default-source/encuesta-suplementaria-de-ingresos/bbdd/stata_esi/2024/esi_2024.dta?sfvrsn=627c0f59_4&download=true")

# Preparar datos
esi_trabajo <- esi2024 |>
  select(sexo, edad, nivel, ing_t_t, activ, region) |>
  filter(activ == 1, !is.na(ing_t_t), ing_t_t > 0) |>
  mutate(
    sexo_etiq = case_when(
      sexo == 1 ~ "Hombre",
      sexo == 2 ~ "Mujer",
      TRUE ~ "Otro"
    ),
    nivel_etiq = case_when(
      nivel == 1 ~ "Sin educaci√≥n",
      nivel == 2 ~ "B√°sica incompleta",
      nivel == 3 ~ "B√°sica completa",
      nivel == 4 ~ "Media incompleta",
      nivel == 5 ~ "Media completa",
      nivel == 6 ~ "T√©cnica incompleta",
      nivel == 7 ~ "T√©cnica completa",
      nivel == 8 ~ "Universitaria incompleta",
      nivel == 9 ~ "Universitaria completa",
      nivel == 10 ~ "Postgrado",
      TRUE ~ "Sin informaci√≥n"
    )
  )

# 4. ESTAD√çSTICA DESCRIPTIVA ----

# Media y mediana de ingresos
mean(esi_trabajo$ing_t_t)
median(esi_trabajo$ing_t_t)

# Por sexo
esi_trabajo |>
  group_by(sexo_etiq) |>
  summarise(
    n = n(),
    Media = mean(ing_t_t),
    Mediana = median(ing_t_t)
  )

# 5. VISUALIZACIONES ----

# Histograma con media y mediana
ggplot(esi_trabajo, aes(x = ing_t_t)) +
  geom_histogram(bins = 50, fill = "steelblue", alpha = 0.7) +
  geom_vline(aes(xintercept = mean(ing_t_t), color = "Media"),
             linewidth = 1.2, linetype = "dashed") +
  geom_vline(aes(xintercept = median(ing_t_t), color = "Mediana"),
             linewidth = 1.2, linetype = "dashed") +
  scale_x_continuous(limits = c(0, 3000000)) +
  theme_minimal()

# Boxplot por sexo
ggplot(esi_trabajo, aes(x = sexo_etiq, y = ing_t_t, fill = sexo_etiq)) +
  geom_boxplot(alpha = 0.7) +
  scale_y_continuous(limits = c(0, 2500000)) +
  theme_minimal()

# 6. TABLAS DE FRECUENCIA ----

# Tabla educaci√≥n
table(esi_trabajo$nivel_etiq)
prop.table(table(esi_trabajo$nivel_etiq)) * 100

# Tabla de contingencia
table(esi_trabajo$sexo_etiq, esi_trabajo$nivel_etiq)

# 7. EJERCICIOS CON DATOS SIMULADOS ----
set.seed(123)
encuesta <- data.frame(
  id = 1:100,
  edad = sample(18:65, 100, replace = TRUE),
  sexo = sample(c("Mujer", "Hombre"), 100, replace = TRUE, prob = c(0.52, 0.48)),
  educacion = sample(c("B√°sica", "Media", "T√©cnica", "Universitaria", "Postgrado"),
                     100, replace = TRUE, prob = c(0.10, 0.30, 0.25, 0.30, 0.05)),
  satisfaccion = sample(1:7, 100, replace = TRUE),
  ingreso = round(rnorm(100, mean = 800000, sd = 300000), -3)
)

# An√°lisis b√°sico
summary(encuesta)
table(encuesta$educacion)
```

---

::: {.callout-note}
## Nota final

Esta sesi√≥n establece las bases para todo el curso. Es fundamental que te sientas c√≥modo/a con:
- La l√≥gica de programaci√≥n en R
- La manipulaci√≥n b√°sica de datos
- El c√°lculo e interpretaci√≥n de estad√≠sticos descriptivos
- La creaci√≥n de visualizaciones

Si alg√∫n concepto no qued√≥ claro, **no dudes en consultar**. Los contenidos son acumulativos y necesitar√°s estas herramientas en todas las sesiones siguientes.

¬°Nos vemos en la Sesi√≥n 2! üöÄ
:::











